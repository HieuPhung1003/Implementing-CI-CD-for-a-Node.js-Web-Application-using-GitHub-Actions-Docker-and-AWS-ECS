{{> header}}

<div class="container">
    <div class="glass-pane">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2 style="margin: 0;">Danh sách hàng hóa</h2>
            <div>
                <a href="/inventory/export" class="btn btn-secondary" style="margin-right: 0.5rem;" target="_blank">⬇
                    Xuất CSV</a>
                <a href="/inventory/add" class="btn btn-success">+ Nhập hàng</a>
            </div>
        </div>

        {{#if message}}
        <div
            style="background: rgba(16, 185, 129, 0.2); color: #34d399; padding: 1rem; border-radius: 0.5rem; margin-bottom: 2rem; border: 1px solid rgba(16, 185, 129, 0.2);">
            {{message}}
        </div>
        {{/if}}

        <form action="/inventory" method="GET" style="margin-bottom: 2rem; display: flex; gap: 1rem;">
            <input type="text" name="q" class="form-control" placeholder="Tìm kiếm sản phẩm..." value="{{searchQuery}}"
                style="flex: 1;">
            <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            <a href="/inventory" class="btn btn-secondary">Đặt lại</a>
        </form>

        {{#if hasProducts}}
        <div class="table-responsive">
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tên sản phẩm</th>
                        <th>Danh mục</th>
                        <th>Số lượng</th>
                        <th>Giá (VNĐ)</th>
                        <th>Quản lý kho</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each products}}
                    <tr>
                        <td>{{this.id}}</td>
                        <td>
                            <strong>{{this.name}}</strong><br>
                            <small style="color: var(--text-muted);">{{this.supplier}}</small>
                        </td>
                        <td>{{this.category}}</td>
                        <td>
                            <span class="badge"
                                style="background: {{#if (quantity_gt_zero this.quantity)}}rgba(16, 185, 129, 0.2); color: #34d399{{else}}rgba(239, 68, 68, 0.2); color: #f87171{{/if}}">
                                {{this.quantity}}
                            </span>
                        </td>
                        <td>{{this.price}}</td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <form action="/inventory/stock/{{this.id}}" method="POST" style="margin: 0;">
                                    <input type="hidden" name="action" value="out">
                                    <button type="submit" class="btn btn-danger"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" title="Xuất 1">-</button>
                                </form>
                                <form action="/inventory/stock/{{this.id}}" method="POST" style="margin: 0;">
                                    <input type="hidden" name="action" value="in">
                                    <button type="submit" class="btn btn-success"
                                        style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" title="Nhập 1">+</button>
                                </form>
                            </div>
                        </td>
                        <td>
                            <div class="flex-end" style="justify-content: flex-start;">
                                <a href="/inventory/edit/{{this.id}}" class="btn btn-secondary"
                                    style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Sửa</a>
                                <a href="/inventory/delete/{{this.id}}" class="btn btn-danger"
                                    style="padding: 0.25rem 0.75rem; font-size: 0.875rem;"
                                    onclick="return confirm('Bạn chắc chắn muốn xóa?');">Xóa</a>
                            </div>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
        {{else}}
        <div class="text-center" style="padding: 3rem;">
            <p>Kho đang trống. Hãy nhập hàng ngay!</p>
            <a href="/inventory/add" class="btn btn-primary">Nhập hàng đầu tiên</a>
        </div>
        {{/if}}
    </div>
</div>

{{> footer}}